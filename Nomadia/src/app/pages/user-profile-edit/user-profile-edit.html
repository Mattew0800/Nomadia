<app-test>

    <!-- PROFILE CARD -->
    <div class="profile-card">
        <div class="profile-header">
            <section class="profile-main">
                <div class="profile-user-profile">
                    <div class="user-image large">
                        <img [src]="photoPreview || 'default-user-img.jpg'" alt="Foto de Usuario">
                    </div>
                    <div class="user-info large">
                        @if(user?.name){
                        <h2 class="user-name">{{user?.name}}</h2>
                        }@else{
                        <h2 class="user-name">Yo</h2>
                        }
                        <p class="user-status">Traveler Pro</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- FORMULARIO -->
        <form [formGroup]="form" (ngSubmit)="save()" novalidate>
            <div class="form-grid">
                <div>
                    <label>Nombre completo</label>
                    <input type="text" formControlName="name"
                        [ngClass]="{'input-invalid': form.get('name')?.invalid && form.get('name')?.touched}">
                </div>

                <div>
                    <label>Apodo</label>
                    <input type="text" formControlName="nick">
                </div>

                <div>
                    <label>Email</label>
                    <input type="email" formControlName="email">
                </div>

                <div>
                    <label>Teléfono</label>
                    <input type="tel" formControlName="phone">
                </div>

                <div>
                    <label>Fecha de nacimiento</label>
                    <input type="date" formControlName="birth">
                    <div *ngIf="f['birth'].errors?.['pattern'] && f['birth'].touched" class="text-danger">
                        <p class="formError">La fecha debe tener formato YYYY-MM-DD con año de 4 dígitos.</p>
                    </div>
                </div>


                <div>
                    <label>Edad</label>
                    <input type="number" formControlName="age" readonly>
                </div>

                <div id="form__grid-aboutme">
                    <label>Sobre mí</label>
                    <textarea formControlName="about" rows="4"></textarea>
                </div>

                <!-- FOTO -->
                <div>
                    <label>Foto de perfil</label>
                    <input type="file" #fileInput accept="image/*" (change)="onSelectPhoto($event)">
                    <div style="margin-top:.5rem; display:flex; gap:.75rem; align-items:center;">
                        <ng-container *ngIf="photoPreview">
                            <img [src]="photoPreview" alt="preview"
                                style="width:64px;height:64px;border-radius:12px;object-fit:cover;">
                            <button type="button" class="filters-btn" (click)="removePhoto()">
                                Quitar foto
                            </button>
                        </ng-container>
                    </div>
                </div>

                <!-- PASSWORD -->
                <div style="grid-column:1/3;">
                    <label style="display:block;margin-bottom:.5rem;">Cambiar contraseña (opcional)</label>
                    <div class="form-grid" style="grid-template-columns:1fr 1fr;">
                        <div>
                            <label>Contraseña actual</label>
                            <input type="password" formControlName="currentPass">
                        </div>

                        <div>
                            <label>Nueva contraseña</label>
                            <input type="password" formControlName="newPass"
                                [ngClass]="{'input-invalid': form.get('newPass')?.invalid && form.get('newPass')?.touched}">
                        </div>

                        <div style="grid-column:1/3;">
                            <label>Confirmar nueva contraseña</label>
                            <input type="password" formControlName="confirmPass"
                                [ngClass]="{'input-invalid': !passwordsMatch() && form.get('confirmPass')?.touched}">
                            <p *ngIf="!passwordsMatch()" class="formError" style="margin-top:.25rem;">
                                Las contraseñas no coinciden.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display:flex; gap:1rem; margin-top:2rem;">
                <button class="edit-btn" type="submit">Guardar cambios</button>
                <button class="filters-btn" type="button" (click)="cancel()">Volver</button>
            </div>

            <div *ngFor="let key of (errorMessages | keyvalue)" class="formError" id="profileEditError">
                <strong>{{ key.key }}:</strong> {{ key.value }}
            </div>


            <p *ngIf="msgOk" style="margin-top:1rem; color:#d1f366;">{{ msgOk }}</p>
            <p *ngIf="msgError" style="margin-top:1rem; color:#eb3f3a;">{{ msgError }}</p>
        </form>

    </div>
</app-test>