- name: Comment on PR
  if: always()
  uses: actions/github-script@v7
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    script: |
      // Obtener los outputs de los steps anteriores
      const branchStatus = "${{ steps.branch-check.outputs.branch_status || '' }}"
      const branchError = `${{ steps.branch-check.outputs.branch_error || '' }}`
      const commitStatus = "${{ steps.commit-check.outputs.commit_status || '' }}`
      const commitError = `${{ steps.commit-check.outputs.commit_error || '' }}`
      const secretStatus = "${{ steps.secret-check.outputs.secret_status || '' }}`
      const secretError = `${{ steps.secret-check.outputs.secret_error || '' }}`
      
      // Construir el cuerpo del comentario de forma segura
      let commentBody = ""

      if(branchStatus === "fail") commentBody += branchError.trim() + "\n\n"
      if(commitStatus === "fail") commentBody += commitError.trim() + "\n\n"
      if(secretStatus === "fail") commentBody += secretError.trim() + "\n\n"

      // Solo crear el comentario si hay contenido
      if(commentBody.length > 0) {
        github.rest.issues.createComment({
          owner: context.repo.owner,
          repo: context.repo.repo,
          issue_number: context.issue.number,
          body: commentBody
        })
      }
